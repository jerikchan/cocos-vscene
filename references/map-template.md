# Scene Map Output Template

This template defines the structure for `.vscene/maps/{sceneName}.map.md` files.

---

## Template Structure

```markdown
# Scene Map: {sceneName}
# 场景地图: {sceneName}

> Generated: {YYYY-MM-DD HH:mm}
> Nodes: {totalNodes} total, {shownNodes} shown ({collapsedGroups} groups collapsed)
> Index: .vscene/scenes/{sceneName}.json
>
> This file is auto-generated by `vscene map`. Re-run to regenerate.
> 此文件由 `vscene map` 自动生成，重新运行即可更新。

---

## Node Map (节点地图)

\`\`\`
{sceneName}                                    # Scene root / 场景根节点
├─ {nodeName} [{components}] ★                # {EN annotation} / {ZH annotation}
│  ├─ {childName} [{components}]              # {EN annotation} / {ZH annotation}
│  ├─ {childName}                             # {EN annotation} / {ZH annotation}
│  └─ [... {N} child nodes / 子节点]
├─ {nodeName} ★                               # {EN annotation} / {ZH annotation}
│  ├─ {childName} [{components}] ★            # {EN annotation} / {ZH annotation}
│  └─ [×{N} {Pattern}*] [{components}]        # {EN annotation} / {ZH annotation}
└─ {nodeName}                                  # {EN annotation} / {ZH annotation} [?]
   └─ [... {N} decoration nodes / 装饰节点]
\`\`\`

---

## Legend (图例)

| Symbol | Meaning |
|--------|---------|
| ★ | Key node (has important components) / 关键节点 |
| [{Component}] | Attached components / 挂载的组件 |
| [×N Pattern*] | N similar nodes collapsed / N 个同类节点已折叠 |
| [... N nodes] | N child nodes omitted / N 个子节点已省略 |
| [?] | Annotation needs confirmation / 注释待确认 |

---

## Quick Reference (快速索引)

| Node | Path | Components | Purpose |
|------|------|------------|---------|
| {NodeName} | /{path/to/node} | {Component1, Component2} | {ZH purpose} |
| {NodeName} | /{path/to/node} | {Component} | {ZH purpose} |
| ... | ... | ... | ... |

---

## Stats (统计)

- Total nodes: {totalNodes}
- Key nodes shown: {keyNodeCount}
- Collapsed groups: {collapsedGroups}
- Max depth: {maxDepth} (map shows to depth {shownMaxDepth})

---

_Generated by VScene Map v1.0_
```

---

## Generation Rules

1. **Annotation alignment** — All `#` comments should start at the same column (column 45) for visual alignment. If the node line exceeds 44 chars, add a single space before `#`.

2. **Node filtering** — Not all nodes appear. The map shows:
   - All depth 0-1 nodes (scene skeleton)
   - All key nodes (`k=true`) at any depth
   - Ancestor containers of key nodes (for path completeness)
   - Non-key leaf/decoration nodes are collapsed into `[... N nodes]`
   - Repeated siblings (>=3 with shared prefix) are collapsed into `[×N Pattern*]`

3. **Annotation inference** — Bilingual annotations are generated automatically:
   - Component-based: match known components to descriptions
   - Name-based: translate English node names to Chinese
   - Container-based: infer from children's types
   - Ambiguous: mark with `[?]` for names like `node1`, pinyin, etc.

4. **Quick Reference table** — Only key nodes (`k=true`) appear in this table. Shows the flat path, components, and Chinese purpose description.

5. **Collapsed labels** — Use descriptive labels based on content:
   - Nodes with MeshRenderer/Sprite → `decoration nodes / 装饰节点`
   - Nodes with ParticleSystem → `particle nodes / 粒子节点`
   - Other nodes → `child nodes / 子节点`

6. **Repeat group detection** — Siblings sharing a common prefix (after stripping trailing digits, parenthesized numbers, or underscore suffixes) are grouped when there are >=3 matches.

---

## Symbol Reference

| Symbol | Used In | Meaning |
|--------|---------|---------|
| `★` | Node Map | Key node marker |
| `[?]` | Annotation | Uncertain/ambiguous annotation |
| `├─` / `└─` | Node Map | Tree branch connector |
| `│` | Node Map | Tree continuation line |
| `[×N ...]` | Node Map | Repeated sibling group |
| `[... N ...]` | Node Map | Collapsed children |
